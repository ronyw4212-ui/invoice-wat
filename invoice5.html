<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invoice PT WAT</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    padding: 20px;
}

.container {
    background: #fff;
    max-width: 900px;
    margin: auto;
    padding: 30px;
    position: relative;
}

.logo {
    width: 100px;
    position: absolute;
    top: 20px;
    left: 20px;
}

h2 {
    text-align: center;
    margin-bottom: 5px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
}

input {
    width: 100%;
    box-sizing: border-box;
}

.total {
    text-align: right;
    font-size: 18px;
    margin-top: 15px;
    font-weight: bold;
}

button {
    padding: 10px 14px;
    margin: 5px;
}

@media print {
    button, input {
        display: none;
    }
    body {
        background: #fff;
    }
}
</style>
</head>

<body>

<div class="container">
<img src="logo.png" class="logo">

<h2>PT WIJAYA ANUGRAH TEKNIK</h2>
<p style="text-align:center;"><b>INVOICE</b></p>

<table>
<tr>
<td>No Invoice</td>
<td id="noInv"></td>
<td>Tanggal</td>
<td id="tgl"></td>
</tr>
<tr>
<td>Pelanggan</td>
<td><input id="pelanggan"></td>
<td>No HP</td>
<td><input id="hp"></td>
</tr>
</table>

<table id="items">
<thead>
<tr>
<th>Deskripsi</th>
<th>Qty</th>
<th>Harga</th>
<th>Total</th>
<th>Aksi</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button onclick="tambahBaris()">+ Tambah Item</button>

<div class="total">TOTAL: Rp <span id="grand">0</span></div>

<div style="text-align:center;margin-top:20px;">
<button onclick="simpan()">Simpan Invoice</button>
<button onclick="window.print()">Simpan PDF</button>
<button onclick="kirimWA()">Kirim WhatsApp</button>
<button onclick="laporan()">Laporan</button>
</div>
</div>

<script>
// ===== TANGGAL & INVOICE =====
const now = new Date();
const dateKey = now.toISOString().split("T")[0];
document.getElementById("tgl").innerText = dateKey;

let count = localStorage.getItem("INV_" + dateKey);
count = count ? parseInt(count) + 1 : 1;
localStorage.setItem("INV_" + dateKey, count);

const noInvoice = String(count).padStart(3,"0") +
"/INV/WAT/" +
String(now.getMonth()+1).padStart(2,"0") +
"/" + now.getFullYear();

document.getElementById("noInv").innerText = noInvoice;

// ===== ITEM =====
function tambahBaris() {
    const row = document.createElement("tr");
    row.innerHTML = `
    <td><input></td>
    <td><input type="number" value="1"></td>
    <td><input type="number" value="0"></td>
    <td class="line">0</td>
    <td><button onclick="this.parentElement.parentElement.remove(); hitung()">‚ùå</button></td>`;
    document.querySelector("#items tbody").appendChild(row);
}
tambahBaris();

function hitung() {
    let total = 0;
    document.querySelectorAll("#items tbody tr").forEach(r=>{
        let q = r.children[1].children[0].value;
        let h = r.children[2].children[0].value;
        let t = q*h;
        r.querySelector(".line").innerText = t;
        total += t;
    });
    document.getElementById("grand").innerText = total;
}
document.addEventListener("input", hitung);

// ===== SIMPAN =====
function simpan() {
    let data = JSON.parse(localStorage.getItem("DATA") || "[]");
    data.push({
        tgl: dateKey,
        invoice: noInvoice,
        pelanggan: pelanggan.value,
        total: parseInt(grand.innerText)
    });
    localStorage.setItem("DATA", JSON.stringify(data));
    alert("Invoice tersimpan");
}

// ===== LAPORAN =====
function laporan() {
    let data = JSON.parse(localStorage.getItem("DATA") || "[]");
    let h=0,m=0,b=0;
    let week = new Date(now);
    week.setDate(now.getDate()-7);

    data.forEach(d=>{
        let dt = new Date(d.tgl);
        if(d.tgl===dateKey) h+=d.total;
        if(dt>=week) m+=d.total;
        if(dt.getMonth()===now.getMonth()) b+=d.total;
    });

    alert(
`LAPORAN
HARIAN : Rp ${h}
MINGGUAN : Rp ${m}
BULANAN : Rp ${b}`
    );
}

// ===== WHATSAPP =====
function kirimWA() {
    let txt = `INVOICE
${noInvoice}
Pelanggan: ${pelanggan.value}
Total: Rp ${grand.innerText}`;
    window.open("https://wa.me/62"+hp.value+"?text="+encodeURIComponent(txt));
}
</script>

</body>
</html>
